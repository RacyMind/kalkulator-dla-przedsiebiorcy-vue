# Implementation Plan: Google Play In-App Review

**Branch**: `020-google-play-rating` | **Date**: 2026-02-09 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/020-google-play-rating/spec.md`

## Summary

Zachęcenie użytkowników aplikacji Android do oceniania w Google Play Store poprzez:

1. **Automatyczny In-App Review** — natywny dialog Google Play wyświetlany przy uruchomieniu aplikacji po spełnieniu warunków (≥5 obliczeń, cooldown 90 dni, max 3 razy)
2. **Opcja w menu** — aktualizacja istniejącego linku „Oceń w Google Play" na „Podoba Ci się? Oceń!" otwierającego Google Play Store

**Podejście techniczne**: Capacitor plugin `@capacitor-community/in-app-review`, Pinia store z `useLocalStorage` do persystencji stanu, boot file do triggera przy starcie, composable do zliczania obliczeń.

## Technical Context

**Language/Version**: TypeScript 5.9+ / Vue 3.5+  
**Framework**: Quasar 2.18+ (UI components)  
**State Management**: Pinia 2.x  
**Testing**: Vitest 4.x  
**Platform**: PWA + Capacitor (Android)  
**Project Type**: Single-page application (SPA)  
**UI Language**: Polish  
**Key Dependencies**:

- `@capacitor/core` — platform detection (`Capacitor.isNativePlatform()`)
- `@capacitor-community/in-app-review` — Google Play In-App Review API (NEW)
- `@vueuse/core` — `useLocalStorage` for state persistence
- `quasar` — `Platform.is.nativeMobile` for menu visibility

## Constitution Check

_GATE: Must pass before Phase 0 research. Re-check after Phase 1 design._

Constitution is a blank template — no project-specific principles defined. No gates to check. Proceeding.

**Post-design re-check**: Design follows existing project patterns (boot files, Pinia stores, composables, `useLocalStorage`). No violations.

## Project Structure

### Documentation (this feature)

```text
specs/020-google-play-rating/
├── plan.md                              # This file
├── spec.md                              # Feature specification
├── research.md                          # Research and analysis
├── data-model.md                        # Data model
├── quickstart.md                        # Quick start guide
├── checklists/
│   └── requirements.md                  # Spec quality checklist
├── contracts/
│   └── review-prompt-service.md         # Service contract
└── tasks.md                             # Task list (generated by /speckit.tasks)
```

### Source Code

```text
src/
├── boot/
│   └── review-prompt.ts                 # NEW: Boot file — triggers In-App Review on app start
├── composables/
│   └── useReviewPrompt.ts              # NEW: Composable for incrementing calculation count
├── stores/
│   └── reviewPromptStore.ts            # NEW: Pinia store for review state persistence
├── components/
│   ├── partials/
│   │   └── menu/
│   │       └── menuItems.ts            # MODIFY: Update menu item title/caption
│   ├── contractWork/
│   │   └── components/Form.vue         # MODIFY: Add incrementCalculationCount()
│   ├── selfEmployment/
│   │   └── components/Form.vue         # MODIFY: Add incrementCalculationCount()
│   └── [other modules]/
│       └── components/Form.vue         # MODIFY: Add incrementCalculationCount()

test/vitest/__tests__/
└── modules/
    └── reviewPrompt/
        └── reviewPromptStore.test.ts   # NEW: Unit tests for store logic
```

## Design Decisions

### D-001: Boot file pattern (not App.vue)

Boot files are the established pattern for app initialization (`admob.ts`). Runs once per app launch.

### D-002: Composable wrapper (not direct store access)

`useReviewPrompt` composable wraps store access. Handles platform check internally — on non-native platforms, `incrementCalculationCount` is a no-op. Keeps Form.vue changes minimal.

### D-003: Store-based persistence (not raw localStorage)

Pinia store with `useLocalStorage` from `@vueuse/core` — consistent with `settingStore.ts` pattern.

### D-004: Update existing menu item (not add new one)

`menuItems.ts` already has "Oceń w Google Play" for native Android. Just update text, no structural changes.

### D-005: Record "prompt requested" not "user rated"

Google Play In-App Review API does not report whether user actually rated. We track dialog request attempts only.

## Pre-Implementation Checklist

- [x] ~~Calculator logic extends `BasicCalculator`~~ (N/A — no calculator in this feature)
- [ ] UI components use Quasar
- [ ] UI text in Polish language
- [x] ~~Validation uses `validationRules`~~ (N/A — no form input)
- [ ] Tests include all output values
- [x] ~~Constants added to `src/logic/constants.ts`~~ (N/A — constants in store file)
- [ ] Changelog updated in `src/components/changeLogs/logs.ts`
- [ ] Boot file registered in `quasar.config.ts`
- [ ] `@capacitor-community/in-app-review` installed and synced
