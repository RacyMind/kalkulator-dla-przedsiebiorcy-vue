# Implementation Plan: System motywów (Light/Dark Mode)

**Branch**: `012-theme-dark-mode` | **Date**: 2026-02-07 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/012-theme-dark-mode/spec.md`

## Summary

Implement a full light/dark/auto theme system for the application. This involves:
1. Enabling Quasar Dark plugin and creating a `useTheme` composable with localStorage persistence
2. Adding a 3-state cyclic toggle button in the toolbar (light → dark → auto)
3. Replacing all hardcoded Quasar color classes with CSS custom properties from `_design-tokens.scss`
4. Making charts dynamically respond to theme changes
5. Preventing FOUC with an inline script in `index.html`

No new calculator logic or modules — this is a cross-cutting UI/theming concern.

## Technical Context

**Language/Version**: TypeScript 5.9+ / Vue 3.5+
**Framework**: Quasar 2.18.6 (UI components, Dark plugin)
**State Management**: Pinia 2.3+
**Testing**: Vitest 4.x
**Platform**: PWA + Capacitor (Android)
**Project Type**: Single-page application (SPA)
**UI Language**: Polish
**Key Dependencies**:
- `@vueuse/core` — `useLocalStorage`, `usePreferredColorScheme`
- Quasar Dark plugin — `Dark.set()`, `.body--dark` class
- `_design-tokens.scss` — CSS custom properties (light + dark variants, already defined in M2.6)
- `useChartColors` composable — reads CSS vars, has `refresh()` method
- `vue-chartjs` + `chart.js` v4 — chart rendering

**Key Files to Modify**:
- `quasar.config.ts` — add Dark plugin
- `index.html` — add FOUC prevention script
- `src/stores/settingStore.ts` — add `themeMode` state
- `src/composables/useTheme.ts` — **NEW** composable
- `src/layouts/MainLayout.vue` — add toggle button, replace hardcoded classes
- `src/components/partials/ModulePageLayout.vue` — replace `bg-white`
- `src/components/partials/SectionHeader.vue` — already uses `.bg-brand`
- `src/css/objects/_sectionHeader.scss` — replace `color: #ffff`
- `src/composables/useChartColors.ts` — integrate with theme watcher
- `src/components/partials/Chart.vue` — dynamic chart options for dark mode
- 17 component files with hardcoded Quasar color classes

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

Constitution file contains placeholder template only — no project-specific gates defined.
**Result: PASS** (no constraints to enforce).

Post-design re-check: N/A (no constitution rules).

## Project Structure

### Documentation (this feature)

```text
specs/012-theme-dark-mode/
├── spec.md              # Feature specification (Clarified)
├── plan.md              # This file
├── research.md          # Research and analysis
├── data-model.md        # Data model (theme state)
├── quickstart.md        # Quick start guide
├── checklists/
│   └── requirements.md  # Spec quality checklist
└── tasks.md             # Task list (generated by /speckit.tasks)
```

### Source Code (changes)

```text
index.html                                    # FOUC prevention inline script
quasar.config.ts                              # Add Dark plugin

src/
├── composables/
│   ├── useTheme.ts                           # NEW: theme management composable
│   └── useChartColors.ts                     # MODIFY: auto-refresh on theme change
├── stores/
│   └── settingStore.ts                       # MODIFY: add themeMode field
├── layouts/
│   └── MainLayout.vue                        # MODIFY: toggle btn + replace color classes
├── components/
│   └── partials/
│       ├── ModulePageLayout.vue              # MODIFY: bg-white → token
│       ├── Chart.vue                         # MODIFY: dark mode chart options
│       └── SectionHeader.vue                 # OK (uses .bg-brand already)
├── css/
│   ├── _design-tokens.scss                   # OK (light + dark already defined)
│   ├── app.scss                              # MODIFY: add dark-mode utility classes
│   └── objects/
│       └── _sectionHeader.scss               # MODIFY: color: #ffff → token
└── [17 component files]                      # MODIFY: replace hardcoded color classes
```

## Pre-Implementation Checklist

- [ ] Quasar Dark plugin added to `quasar.config.ts`
- [ ] `useTheme` composable created with 3-state cycling
- [ ] FOUC prevention script in `index.html`
- [ ] `settingStore.ts` extended with `themeMode`
- [ ] Toggle button in `MainLayout.vue` toolbar
- [ ] All 17 files with hardcoded color classes migrated to tokens
- [ ] `_sectionHeader.scss` updated to use token
- [ ] `useChartColors` auto-refreshes on theme change
- [ ] Chart labels/axes readable in dark mode
- [ ] UI text in Polish language
- [ ] All existing tests (410/410) pass
- [ ] Visual verification of all 29 modules in dark mode
- [ ] Changelog updated in `src/components/changeLogs/logs.ts`
