# Implementation Plan: Accessibility (WCAG AA)

**Branch**: `014-wcag-accessibility` | **Date**: 2026-02-07 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/014-wcag-accessibility/spec.md`

## Summary

Doprowadzić aplikację Kalkulator Finansowy do zgodności z WCAG 2.1 na poziomie AA. Obejmuje: semantyczny HTML (landmarks, nagłówki), nawigację klawiaturą (skip-to-content, focus ring, Escape), atrybuty ARIA (aria-label, aria-expanded, aria-live, aria-required, aria-describedby), weryfikację kontrastu kolorów (light + dark mode), oraz dostępne formularze. Nie tworzy nowych modułów ani logiki obliczeniowej — modyfikuje istniejące komponenty współdzielone i layout.

## Technical Context

**Language/Version**: TypeScript 5.9+ / Vue 3.5+  
**Framework**: Quasar 2.18+ (UI components)  
**State Management**: Pinia 2.3+  
**Testing**: Vitest 4.x  
**Platform**: PWA (Progressive Web App) + Capacitor (Android)  
**Project Type**: Single-page application (SPA)  
**UI Language**: Polish  
**Key Dependencies**:
- Quasar components (`q-input`, `q-btn`, `q-expansion-item`, `q-drawer`) — built-in partial a11y support
- Chart.js 4 + vue-chartjs — canvas-based charts, not natively accessible
- `_design-tokens.scss` — CSS custom properties for colors (light + dark mode), already WCAG AA-aware
- `useChartColors.ts` — composable for chart color palette

**Current Accessibility State** (audit of existing codebase):

| Component | Current State | Gap |
|---|---|---|
| `index.html` | Missing `lang="pl"` on `<html>` | AR-006 |
| `MainLayout.vue` | Has `aria-label` on hamburger + theme toggle | No `<main>`, `<nav>`, `<aside>`, `<footer>` landmarks; no skip-to-content |
| `SectionHeader.vue` | Already uses dynamic `<h2>`/`<h3>` via `level` prop | Needs verification of correct `level` usage across modules |
| `ListRow.vue` | Uses `q-item`/`q-item-section` | No semantic `<dl>` or ARIA roles for result lists |
| `FormSection.vue` | Has collapsible sections with `q-slide-transition` | No `aria-expanded`, no `aria-label` on toggle button |
| `Chart.vue` | Canvas-based, no alt text | No `aria-label` or `<figcaption>` |
| `ScrollToTop.vue` | Has `aria-label="Powrót na górę"` ✅ | — |
| `SubmitButton.vue` | Has `label="Oblicz"` ✅ | — |
| Module Forms (e.g. contractWork) | `q-input` has `label` prop ✅ | Missing `aria-required`, `aria-describedby` for validation |
| Focus styles | Default browser/Quasar | No custom `:focus-visible` ring |
| Total `aria-` attributes in codebase | 3 occurrences | Needs significant expansion |

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

Constitution file contains template placeholders only — no project-specific gates defined. **GATE PASSED** (no constraints to violate).

Implicit project constraints verified:
- ✅ UI components use Quasar
- ✅ UI text in Polish language
- ✅ No changes to calculation logic (no regression risk)
- ✅ Existing tests (410+) must continue to pass

**Post-design re-check (Phase 1 complete)**:
- ✅ No new dependencies introduced
- ✅ All changes are template/CSS modifications — no logic changes
- ✅ Component contracts preserve existing props (backward compatible)
- ✅ New `ariaLabel` prop on `Chart.vue` has default value — no breaking change
- ✅ All ARIA attributes are standard HTML — no framework conflicts

## Project Structure

### Documentation (this feature)

```text
specs/014-wcag-accessibility/
├── plan.md              # This file
├── research.md          # Research and analysis
├── data-model.md        # Data model (minimal — no new entities)
├── quickstart.md        # Quick start guide
├── checklists/
│   └── requirements.md  # Spec quality checklist
└── tasks.md             # Task list (generated by /speckit.tasks)
```

### Source Code (files to modify)

```text
index.html                                    # Add lang="pl", skip-to-content link
src/
├── layouts/
│   └── MainLayout.vue                        # Add landmarks (<main>, <nav>, <aside>, <footer>)
├── components/
│   └── partials/
│       ├── SectionHeader.vue                 # Verify heading level usage
│       ├── ListRow.vue                       # Add ARIA roles for result lists
│       ├── Chart.vue                         # Add aria-label for chart accessibility
│       ├── ScrollToTop.vue                   # Already accessible ✅
│       ├── ModulePageLayout.vue              # Add aria-live on results slot
│       ├── form/
│       │   ├── FormSection.vue               # Add aria-expanded, aria-label
│       │   └── SubmitButton.vue              # Already accessible ✅
│       └── menu/
│           └── Menu.vue                      # Wrap in <nav>, add aria-label
├── css/
│   ├── _design-tokens.scss                   # Contrast fixes if needed
│   └── app.scss                              # Add focus-visible styles, skip-to-content styles
└── composables/
    └── useScrollToResults.ts                 # Manage focus after calculation

test/vitest/__tests__/                        # Existing tests — verify no regression
```

## Pre-Implementation Checklist

- [x] UI components use Quasar
- [x] UI text in Polish language
- [ ] All landmarks (`<main>`, `<nav>`, `<aside>`, `<footer>`) added
- [ ] Skip-to-content link added
- [ ] `lang="pl"` added to `<html>`
- [ ] Focus ring (`:focus-visible`) styled globally
- [ ] `aria-expanded` added to FormSection toggle
- [ ] `aria-live="polite"` added to results container
- [ ] `aria-label` added to all icon-only buttons
- [ ] `aria-required` added to required form fields
- [ ] `aria-describedby` linked to validation messages
- [ ] Chart.vue has accessible alternative text
- [ ] Heading hierarchy verified (no level skips)
- [ ] Lighthouse Accessibility ≥ 90 (light + dark)
- [ ] axe-core: 0 critical/serious errors
- [ ] All existing tests pass (410+)
- [ ] Changelog updated in `src/components/changeLogs/logs.ts`
