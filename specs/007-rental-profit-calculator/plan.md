# Implementation Plan: Kalkulator zysku z najmu

**Branch**: `007-rental-profit-calculator` | **Date**: 2026-02-06 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/007-rental-profit-calculator/spec.md`

## Summary

Kalkulator zysku z najmu prywatnego na ryczałcie ewidencjonowanym. Oblicza podatek ryczałtowy (8,5% do 100 000 zł, 12,5% od nadwyżki), zysk netto i generuje projekcję wieloletnią. Obsługuje opcję małżonków (próg 200 000 zł), pustostany i roczną waloryzację czynszu.

**Technical approach**: Nowy moduł `rentalProfit` w `src/components/` wg wzorca `contractWork`. Calculator class rozszerzający `BasicCalculator`, Pinia store, UI z dwoma zakładkami (q-tabs jak w selfEmployment). Brak zewnętrznych API — czysta logika kliencka.

## Technical Context

**Language/Version**: TypeScript 4.5+ / Vue 3.4+  
**Framework**: Quasar 2.18+ (UI components)  
**State Management**: Pinia 2.x  
**Testing**: Vitest 2.x  
**Platform**: PWA (Progressive Web App) + Capacitor (Android/iOS)  
**Project Type**: Single-page application (SPA)  
**UI Language**: Polish  
**Key Dependencies**:
- `BasicCalculator<InputFieldType, ResultType>` — abstract base class (`src/logic/BasicCalculator.ts`): `setInputData()`, `calculate()`, `getResult()`
- `Calculator<InputDataType, ResultType>` — interface (`src/logic/interfaces/Calculator.ts`)
- `validationRules` — form validation (`src/logic/validationRules.ts`): `required`, `requiredAmount`, `minValue(n)`, `maxValue(n)`, `greaterThan(n)`, `lessThan(n)`
- `helpers.round(value, precision)` — rounding utility (`src/logic/helpers.ts`)
- `pln()` — currency formatting composable
- `useLocalStorage` from `@vueuse/core` — persistent form state
- Quasar: `q-tabs`, `q-tab-panels`, `q-input`, `q-toggle`, `q-form`, `q-btn`
- Shared partials: `ModulePageLayout`, `SectionHeader`, `Advert`, `Separator`, `ListHeader`, `list-row`

**Reference modules**:
- `contractWork` — simplest module pattern (single calculator, store, form, result list)
- `selfEmployment` — tab-based UI pattern (q-tabs with AnnualSummary / EachMonth)

**Router**: Lazy-loaded routes in `src/router/routes.ts`, pattern: `{ component: () => import('...'), path: 'slug' }`

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

Constitution is not yet configured (template placeholders only). No gates to enforce. Proceeding.

## Project Structure

### Documentation (this feature)

```text
specs/007-rental-profit-calculator/
├── plan.md              # This file
├── spec.md              # Feature specification
├── research.md          # Research and analysis
├── data-model.md        # Data model
├── quickstart.md        # Quick start
├── checklists/
│   └── requirements.md  # Quality checklist
├── contracts/
│   └── calculator-api.md # Calculator API contract
└── tasks.md             # Task list (generated by /speckit.tasks)
```

### Source Code

```text
src/
├── components/
│   └── rentalProfit/                # New calculator module
│       ├── components/
│       │   ├── Form.vue             # Input form
│       │   ├── AnnualResultList.vue  # "Podsumowanie roczne" tab content
│       │   └── ProjectionTable.vue   # "Projekcja wieloletnia" tab content
│       ├── interfaces/
│       │   ├── InputFields.ts        # Input interface
│       │   └── Result.ts             # Result interfaces
│       ├── logic/
│       │   └── RentalProfitCalculator.ts  # Calculator (extends BasicCalculator)
│       ├── pages/
│       │   └── Index.vue             # Main page with tabs
│       └── store.ts                  # Pinia store
├── logic/
│   ├── BasicCalculator.ts           # Base class (existing)
│   ├── constants.ts                 # Add rental tax constants
│   ├── validationRules.ts           # Existing rules (reuse)
│   └── helpers.ts                   # Existing helpers (reuse)
├── router/
│   └── routes.ts                    # Add route: 'zysk-z-najmu'

test/vitest/__tests__/
└── modules/
    └── rentalProfit/
        └── RentalProfitCalculator.test.ts  # Calculator tests
```

**Module Pattern**: Use `src/components/contractWork/` as reference for structure, `src/components/selfEmployment/` for tab UI pattern.

## Pre-Implementation Checklist

- [ ] Calculator logic extends `BasicCalculator`
- [ ] UI components use Quasar
- [ ] UI text in Polish language
- [ ] Validation uses `validationRules`
- [ ] Tests include all output values
- [ ] Constants added to `src/logic/constants.ts` (rental tax rates and thresholds)
- [ ] Route added to `src/router/routes.ts`
- [ ] Changelog updated in `src/components/changeLogs/logs.ts`
