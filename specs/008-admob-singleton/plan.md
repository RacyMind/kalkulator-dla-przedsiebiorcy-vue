# Implementation Plan: AdMob Singleton

**Branch**: `008-admob-singleton` | **Date**: 2026-02-06 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/008-admob-singleton/spec.md`

## Summary

Zintegrować AdMob banner jako singleton — inicjalizacja SDK i `showBanner()` raz przy starcie natywnej aplikacji Android. Kontrola widoczności przez `hideBanner()`/`resumeBanner()` w router guard. Na web/PWA bez zmian — dotychczasowe banery wewnętrzne.

## Technical Context

**Language/Version**: TypeScript 4.5+ / Vue 3.4+  
**Framework**: Quasar 2.18+ (UI components)  
**State Management**: Pinia 2.x (opcjonalnie dla stanu reklamy)  
**Testing**: Vitest 2.x  
**Platform**: PWA + Capacitor 6 (Android)  
**Project Type**: Single-page application (SPA)  
**UI Language**: Polish  
**Key Dependencies**:
- `@capacitor-community/admob@6` — plugin AdMob dla Capacitor 6 (NOWA)
- `@capacitor/core` — detekcja platformy (`Capacitor.isNativePlatform()`)
- Quasar boot files — mechanizm inicjalizacji przy starcie
- Vue Router — `afterEach` guard do kontroli widoczności bannera

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

Constitution nie jest skonfigurowana (template placeholders). Brak gates do weryfikacji. PASS.

## Project Structure

### Documentation (this feature)

```text
specs/008-admob-singleton/
├── plan.md              # This file
├── research.md          # Research and analysis
├── data-model.md        # Data model (service state)
├── quickstart.md        # Quick start
├── contracts/           # API contracts
│   └── admob-service.md # AdMob service contract
└── tasks.md             # Task list (generated by /speckit.tasks)
```

### Source Code

```text
src/
├── boot/
│   └── admob.ts                # Boot file — singleton init + router guard
├── services/
│   └── admob/
│       ├── AdMobService.ts     # Singleton service class
│       ├── adConfig.ts         # Konfiguracja (Ad Unit IDs, strony bez reklam)
│       └── types.ts            # TypeScript types
├── components/
│   └── partials/
│       └── Advert.vue          # Zmodyfikowany — warunkowe renderowanie

src-capacitor/
├── capacitor.config.json       # Dodać plugin config (jeśli potrzebne)
└── android/app/src/main/
    ├── AndroidManifest.xml     # Dodać meta-data AdMob APPLICATION_ID
    └── res/values/strings.xml  # Dodać admob_app_id

test/vitest/__tests__/
└── services/
    └── admob/
        └── AdMobService.test.ts  # Testy singletona
```

## Key Design Decisions

### D1: Banner jako natywny overlay (BOTTOM_CENTER)

Spec zakładał banner "między formularzem a wynikami". To niemożliwe — AdMob banner w Capacitor to **natywny overlay** wyświetlany NAD WebView. Standardowa pozycja: `BOTTOM_CENTER` (dół ekranu). Content wymaga `margin-bottom` aby banner nie zasłaniał treści.

### D2: Boot file jako punkt inicjalizacji

`src/boot/admob.ts` — analogicznie do `google-analytics.ts`. Boot file ma dostęp do routera i wykonuje się raz przy starcie. Idealny dla singletona.

### D3: Router afterEach do kontroli widoczności

Lista stron BEZ reklamy (4 strony) jest krótsza niż lista Z reklamą (~28 stron). Łatwiej wykluczać. Router `afterEach` sprawdza path i wywołuje `hideBanner()` lub `resumeBanner()`.

### D4: Advert.vue — warunkowe renderowanie

Na natywnej platformie: `Advert.vue` renderuje pusty div (lub nic) — banner jest natywnym overlay. Na web/PWA: bez zmian — Donate/TaxDonation.

## Pre-Implementation Checklist

- [ ] `@capacitor-community/admob@6` zainstalowany w `src-capacitor/`
- [ ] AndroidManifest.xml skonfigurowany z APPLICATION_ID
- [ ] Boot file `admob.ts` dodany do `quasar.config.js`
- [ ] AdMobService singleton zaimplementowany
- [ ] Router guard kontroluje widoczność bannera
- [ ] Advert.vue zmodyfikowany (platform-aware)
- [ ] Testy singletona napisane
- [ ] Test na emulatorze Android — 1 request, banner widoczny
- [ ] Changelog zaktualizowany
